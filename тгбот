from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
from telegram import ParseMode

# Ð¢Ð¾ÐºÐµÐ½ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¾Ñ‚Ð°
TOKEN = "7043016541:AAEgW7YIFWooOxBvv1MPCAYjtB5gYGUl7JE"

# Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
user_data = {}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÑ‚Ð°Ñ€Ñ‚
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    if user_id not in user_data:
        user_data[user_id] = {
            "level": 1,
            "xp": 0,
            "gold": 100,
            "inventory": [],
            "health": 100,
            "energy": 100,
            "skills": {},
        }
    await show_menu(update)

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð¼ÐµÐ½ÑŽ
async def show_menu(update: Update) -> None:
    keyboard = [
        [InlineKeyboardButton("Ð‘Ð¾Ð¹", callback_data="fight")],
        [InlineKeyboardButton("ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ", callback_data="profile")],
        [InlineKeyboardButton("Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ", callback_data="inventory")],
        [InlineKeyboardButton("ÐœÐ°Ð³Ð°Ð·Ð¸Ð½", callback_data="shop")],
        [InlineKeyboardButton("Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ°", callback_data="train")],
        [InlineKeyboardButton("ÐœÐ¸ÑÑÐ¸Ð¸", callback_data="missions")],
        [InlineKeyboardButton("Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³", callback_data="ranking")],
        [InlineKeyboardButton("ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸", callback_data="settings")],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(
        "Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð¸Ð³Ñ€Ñƒ! Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:", reply_markup=reply_markup
    )

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº
async def button(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    user_id = query.from_user.id
    await query.answer()

    if query.data == "fight":
        await fight(query, user_id)
    elif query.data == "profile":
        await profile(query, user_id)
    elif query.data == "inventory":
        await inventory(query, user_id)
    elif query.data == "shop":
        await shop(query, user_id)
    elif query.data == "train":
        await train(query, user_id)
    elif query.data == "missions":
        await missions(query, user_id)
    elif query.data == "ranking":
        await ranking(query, user_id)
    elif query.data == "settings":
        await settings(query, user_id)

# 1. Ð‘Ð¾Ð¹
async def fight(query, user_id):
    user = user_data[user_id]
    user["health"] -= 10
    user["xp"] += 50
    user["gold"] += 20
    await query.edit_message_text(
        f"*Ð’Ñ‹ ÑÑ€Ð°Ð·Ð¸Ð»Ð¸ÑÑŒ!* ðŸŽ¯\n\n"
        f"Ð’Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸: 50 Ð¾Ð¿Ñ‹Ñ‚Ð° Ð¸ 20 Ð·Ð¾Ð»Ð¾Ñ‚Ð°! ðŸ’°\n"
        f"Ð’Ð°ÑˆÐµ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ: {user['health']} â¤\n"
    )
    await show_menu(query)

# 2. ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ
async def profile(query, user_id):
    user = user_data[user_id]
    await query.edit_message_text(
        f"*Ð’Ð°Ñˆ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ* ðŸ“\n\n"
        f"Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ: {user['level']} ðŸ”¼\n"
        f"ÐžÐ¿Ñ‹Ñ‚: {user['xp']} ðŸŒŸ\n"
        f"Ð—Ð¾Ð»Ð¾Ñ‚Ð¾: {user['gold']} ðŸ’°\n"
        f"Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ: {user['health']} â¤\n"
        f"Ð­Ð½ÐµÑ€Ð³Ð¸Ñ: {user['energy']} âš¡\n"
    )
    await show_menu(query)

# 3. Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ
async def inventory(query, user_id):
    user = user_data[user_id]
    inventory = ", ".join(user["inventory"]) if user["inventory"] else "Ð’Ð°Ñˆ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ð¿ÑƒÑÑ‚."
    await query.edit_message_text(f"*Ð’Ð°Ñˆ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ* ðŸŽ’\n\n{inventory}")
    await show_menu(query)

# 4. ÐœÐ°Ð³Ð°Ð·Ð¸Ð½
async def shop(query, user_id):
    await query.edit_message_text(
        "*ÐœÐ°Ð³Ð°Ð·Ð¸Ð½* ðŸª\n\nÐŸÐ¾ÐºÐ° Ñ‡Ñ‚Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ Ð¿ÑƒÑÑ‚. ÐÐ¾ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼ Ð·Ð´ÐµÑÑŒ Ð¿Ð¾ÑÐ²ÑÑ‚ÑÑ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ñ‹ Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸."
    )
    await show_menu(query)

# 5. Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ°
async def train(query, user_id):
    user = user_data[user_id]
    user["xp"] += 30
    await query.edit_message_text(
        "*Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ°* ðŸ’ª\n\nÐ’Ñ‹ Ð¿Ð¾Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð°Ð»Ð¸ÑÑŒ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸ 30 Ð¾Ð¿Ñ‹Ñ‚Ð°!"
    )
    await show_menu(query)

# 6. ÐœÐ¸ÑÑÐ¸Ð¸
async def missions(query, user_id):
    await query.edit_message_text(
        "*ÐœÐ¸ÑÑÐ¸Ð¸* ðŸ“œ\n\nÐœÐ¸ÑÑÐ¸Ð¸ Ð¿Ð¾ÐºÐ° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹. ÐžÐ¶Ð¸Ð´Ð°Ð¹Ñ‚Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹!"
    )
    await show_menu(query)

    # 7. Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³
    async def ranking(query, user_id):
        await query.edit_message_text(
            "*Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³* ðŸ†\n\nÐ ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² ÐµÑ‰Ñ‘ Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ. Ð¡Ð»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° Ð½Ð¾Ð²Ð¾ÑÑ‚ÑÐ¼Ð¸!"
        )
        await show_menu(query)

    # 8. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    async def settings(query, user_id):
        await query.edit_message_text(
            "*ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸* âš™ï¸\n\nÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸: Ð·Ð´ÐµÑÑŒ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¸Ð³Ñ€Ñ‹."
        )
        await show_menu(query)

    # ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°
    def main() -> None:
        application = Application.builder().token(TOKEN).build()

        application.add_handler(CommandHandler("start", start))
        application.add_handler(CallbackQueryHandler(button))

        application.run_polling()

    if name == "main":
        main()
